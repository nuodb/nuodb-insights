{"meta":{"type":"db","canSave":true,"canEdit":true,"canAdmin":true,"canStar":true,"canDelete":true,"slug":"sql-logs","url":"/d/c9081118-5230-478d-b6e8-d76614395704/sql-logs","expires":"0001-01-01T00:00:00Z","created":"2023-07-29T14:51:47Z","updated":"2023-07-29T17:32:38Z","updatedBy":"admin","createdBy":"admin","version":6,"hasAcl":false,"isFolder":false,"folderId":20,"folderUid":"b7c2a563-48a3-426d-be2b-0f9fffbd8a85","folderTitle":"nuodb_client","folderUrl":"/dashboards/f/b7c2a563-48a3-426d-be2b-0f9fffbd8a85/nuodb-client","provisioned":false,"provisionedExternalId":"","annotationsPermissions":{"dashboard":{"canAdd":true,"canEdit":true,"canDelete":true},"organization":{"canAdd":true,"canEdit":true,"canDelete":true}},"publicDashboardAccessToken":"","publicDashboardUid":"","publicDashboardEnabled":false},"dashboard":{"annotations":{"list":[{"$$hashKey":"object:65","builtIn":1,"datasource":{"type":"datasource","uid":"grafana"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"},{"$$hashKey":"object:2934","datasource":{"type":"datasource","uid":"grafana"},"enable":true,"hide":false,"iconColor":"rgba(255, 96, 96, 1)","limit":100,"name":"db annotations","showIn":0,"tags":["$database"],"type":"tags"}]},"description":"NuoDB Summary","editable":true,"fiscalYearStartMonth":0,"graphTooltip":1,"id":34,"links":[{"asDropdown":true,"icon":"external link","includeVars":true,"keepTime":true,"tags":["overview"],"title":"top views","type":"dashboards"},{"asDropdown":true,"icon":"external link","includeVars":true,"keepTime":true,"tags":["nuodb"],"title":"nuodb","type":"dashboards"}],"liveNow":false,"panels":[{"collapsed":false,"datasource":{"type":"influxdb","uid":"P7F1571328205BBA6"},"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":8,"panels":[],"targets":[{"datasource":{"type":"influxdb","uid":"P7F1571328205BBA6"},"refId":"A"}],"title":"Summary","type":"row"},{"aliasColors":{},"bars":true,"dashLength":10,"dashes":false,"datasource":{"type":"influxdb","uid":"P7F1571328205BBA6"},"description":"The left y-axis is for the stack bar graph that shows relative (in terms of cores) breakdown of where processing time is being spent.  The right y-axis and grey shadow area graph is an indication of the total number of cores available by all selected TEs.","fieldConfig":{"defaults":{"links":[]},"overrides":[]},"fill":1,"fillGradient":0,"gridPos":{"h":4,"w":24,"x":0,"y":1},"hiddenSeries":false,"id":6,"interval":"$interval","legend":{"avg":false,"current":false,"max":false,"min":false,"show":false,"total":false,"values":false},"lines":false,"linewidth":1,"nullPointMode":"null","options":{"alertThreshold":true},"paceLength":10,"percentage":false,"pluginVersion":"10.0.3","pointradius":2,"points":false,"renderer":"flot","seriesOverrides":[{"$$hashKey":"object:133","alias":"NumberCores","bars":false,"color":"rgb(255, 255, 255)","fill":1,"lines":true,"linewidth":0,"stack":false,"steppedLine":true,"yaxis":2}],"spaceLength":10,"stack":true,"steppedLine":false,"targets":[{"alias":"$measurement","datasource":{"type":"influxdb","uid":"P7F1571328205BBA6"},"groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"orderByTime":"ASC","policy":"default","query":"SELECT sum(nthreads) as \"nthreads\" FROM (SELECT mean(raw) / 10000. as \"nthreads\" FROM \"Summary.Fetch\",\"Summary.Commit\",\"Summary.Sync\",\"Summary.Lock\",\"Summary.NtwkSend\",\"Summary.Throttle\",\"Summary.CPU\" WHERE $timeFilter AND nodetype = 'Transaction' AND host =~ /^$host$/ AND db =~ /^$database$/ GROUP BY time($__interval), \"pid\" fill(null)) GROUP BY time($__interval)","rawQuery":true,"refId":"A","resultFormat":"time_series","select":[[{"params":["value"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[]},{"alias":"$measurement","datasource":{"type":"influxdb","uid":"P7F1571328205BBA6"},"groupBy":[{"params":["$__interval"],"type":"time"},{"params":["null"],"type":"fill"}],"hide":false,"measurement":"NumberCores","orderByTime":"ASC","policy":"default","query":"SELECT sum(ncores) FROM (SELECT mean(\"raw\") as ncores FROM \"NumberCores\" WHERE (\"db\" =~ /^$database$/ AND \"host\" =~ /^$host$/ AND \"nodetype\" = 'Transaction') AND $timeFilter GROUP BY time($__interval), \"startid\" fill(null)) GROUP BY time($__interval)","rawQuery":true,"refId":"C","resultFormat":"time_series","select":[[{"params":["raw"],"type":"field"},{"params":[],"type":"mean"}]],"tags":[{"key":"db","operator":"=~","value":"/^$database$/"},{"condition":"AND","key":"host","operator":"=~","value":"/^$host$/"},{"condition":"AND","key":"nodetype","operator":"=","value":"Transaction"}]}],"thresholds":[],"timeRegions":[],"title":"Summary","tooltip":{"shared":true,"sort":2,"value_type":"individual"},"type":"graph","xaxis":{"mode":"time","show":true,"values":[]},"yaxes":[{"$$hashKey":"object:150","decimals":1,"format":"short","label":"measurement relative to vCPU","logBase":1,"min":"0","show":true},{"$$hashKey":"object:151","format":"short","label":"total number of vCPU","logBase":1,"show":true}],"yaxis":{"align":false}},{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":5},"id":9,"panels":[],"title":"Log","type":"row"},{"datasource":{"type":"marcusolsson-json-datasource","uid":"fb12902f-919a-4aa9-89de-398bdfce52df"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"auto","cellOptions":{"type":"auto"},"inspect":true},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"string"},"overrides":[]},"gridPos":{"h":2,"w":24,"x":0,"y":6},"id":12,"options":{"cellHeight":"md","footer":{"countRows":false,"enablePagination":false,"fields":"","reducer":["sum"],"show":false},"showHeader":false},"pluginVersion":"10.0.3","targets":[{"body":"select sqlstring from system.localstatementcache where ID='$statement'","cacheDurationSeconds":0,"datasource":{"type":"marcusolsson-json-datasource","uid":"fb12902f-919a-4aa9-89de-398bdfce52df"},"fields":[{"jsonPath":"$.rows[*][0]","name":"sqlstring"}],"method":"POST","params":[["dbname","$database"],["hostname","localhost"]],"queryParams":"","refId":"A","urlPath":"/query"}],"transparent":true,"type":"table"},{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"fieldConfig":{"defaults":{"color":{"mode":"continuous-GrYlRd"},"custom":{"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":-1,"drawStyle":"bars","fillOpacity":90,"gradientMode":"scheme","hideFrom":{"legend":false,"tooltip":false,"viz":false},"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"auto","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"displayName":"Count","mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[]},"gridPos":{"h":6,"w":24,"x":0,"y":8},"id":10,"interval":"$loginterval","maxDataPoints":500,"options":{"legend":{"calcs":["sum"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"single","sort":"none"}},"targets":[{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"editorMode":"builder","expr":"sum by(source) (count_over_time({source=\"executions\", statement=~\"$statement\", explainplan=~\"$execution\", db=\"$database\", hostname=~\"$host\"} |~ `$filter` | logfmt [$__interval]))","queryType":"range","refId":"A"}],"title":"Log Counts","type":"timeseries"},{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"description":"Output is limited to 2000 lines","gridPos":{"h":20,"w":24,"x":0,"y":14},"id":11,"interval":"1s","options":{"dedupStrategy":"none","enableLogDetails":true,"prettifyLogMessage":false,"showCommonLabels":false,"showLabels":false,"showTime":true,"sortOrder":"Descending","wrapLogMessage":false},"targets":[{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"editorMode":"builder","expr":"{source=\"executions\", statement=~\"$statement\", explainplan=~\"$execution\", db=\"$database\", hostname=~\"$host\"} |~ `$filter` | logfmt","maxLines":2000,"queryType":"range","refId":"A"}],"title":"Statement Execution Logs","transformations":[],"type":"logs"}],"refresh":false,"schemaVersion":38,"style":"dark","tags":["sql","overview"],"templating":{"list":[{"auto":true,"auto_count":100,"auto_min":"10ms","current":{"selected":false,"text":"1s","value":"1s"},"hide":0,"label":"interval","name":"loginterval","options":[],"query":"","queryValue":"","refresh":2,"skipUrlSync":false,"type":"interval"},{"auto":true,"auto_count":"50","auto_min":"10s","current":{"selected":false,"text":"auto","value":"$__auto_interval_interval"},"hide":2,"label":"interval","name":"interval","options":[{"selected":true,"text":"auto","value":"$__auto_interval_interval"},{"selected":false,"text":"10s","value":"10s"},{"selected":false,"text":"30s","value":"30s"},{"selected":false,"text":"1m","value":"1m"},{"selected":false,"text":"5m","value":"5m"},{"selected":false,"text":"10m","value":"10m"},{"selected":false,"text":"15m","value":"15m"},{"selected":false,"text":"30m","value":"30m"},{"selected":false,"text":"1h","value":"1h"},{"selected":false,"text":"6h","value":"6h"},{"selected":false,"text":"12h","value":"12h"},{"selected":false,"text":"1d","value":"1d"},{"selected":false,"text":"7d","value":"7d"},{"selected":false,"text":"14d","value":"14d"},{"selected":false,"text":"30d","value":"30d"}],"query":"10s,30s,1m,5m,10m,15m,30m,1h,6h,12h,1d,7d,14d,30d","queryValue":"","refresh":2,"skipUrlSync":false,"type":"interval"},{"allValue":".*","current":{"selected":false,"text":"test","value":"test"},"datasource":{"type":"influxdb","uid":"P7F1571328205BBA6"},"definition":"","hide":0,"includeAll":false,"label":"Database","multi":false,"name":"database","options":[],"query":"select distinct(\"db\") from (select first(raw) from \"Milliseconds\" where $timeFilter GROUP BY \"db\")\n","refresh":2,"regex":".*","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false},{"allValue":".*","current":{"selected":true,"text":["All"],"value":["$__all"]},"datasource":{"type":"influxdb","uid":"P7F1571328205BBA6"},"definition":"","hide":0,"includeAll":true,"label":"Host","multi":true,"name":"host","options":[],"query":"select distinct(\"host\") from (select first(raw) from \"Milliseconds\" where $timeFilter AND db =~ /$database$/ AND nodetype = 'Transaction' GROUP BY \"host\")\n","refresh":2,"regex":".*","skipUrlSync":false,"sort":0,"tagValuesQuery":"","tagsQuery":"","type":"query","useTags":false},{"current":{"selected":false,"text":".+","value":".+"},"hide":0,"label":"statement","name":"statement","options":[{"selected":true,"text":".+","value":".+"}],"query":".+","skipUrlSync":false,"type":"textbox"},{"current":{"selected":false,"text":".+","value":".+"},"hide":0,"label":"execution","name":"execution","options":[{"selected":true,"text":".+","value":".+"}],"query":".+","skipUrlSync":false,"type":"textbox"},{"current":{"selected":false,"text":"","value":""},"description":"regex filter for each line,  use to limit results before logfmt","hide":0,"label":"filter","name":"filter","options":[{"selected":false,"text":"","value":""}],"query":"","skipUrlSync":false,"type":"textbox"},{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"filters":[],"hide":0,"label":"query","name":"query","skipUrlSync":false,"type":"adhoc"}]},"time":{"from":"2023-07-29T04:05:47.002Z","to":"2023-07-29T04:11:18.190Z"},"timepicker":{"refresh_intervals":["5s","10s","30s","1m","5m","15m","30m","1h","2h","1d"],"time_options":["5m","15m","1h","6h","12h","24h","2d","7d","30d"]},"timezone":"","title":"SQL Logs","uid":"c9081118-5230-478d-b6e8-d76614395704","version":6,"weekStart":""}}